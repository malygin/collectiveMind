- if can_union_discontents?(@project) and @aspect
  %section
    .body.widget-panel
      %ul.nav.nav-tabs#tab_posts
        %li#old.active
          %a{href: "#origin", "data-toggle" => "tab", role: "tab"}
            ="#{t('show.discontent.origin')} #{@aspect.aspect_posts.count}"
        %li#new
          =link_to "#{t('show.discontent.unions')} #{@project.discontent_accepted_post.count}", "/project/#{@project.id}/discontent/posts/unions", remote: true, "data-toggle" => "tab", role: "tab"
        %li#imp
          %a{href: "#improve", "data-toggle" => "tab", role: "tab"}
            =t('show.improve.problem')
      %br
      %br
      #form_for_group_discontent
      .tab-content
        #origin.tab-pane.fade.in.active
          .row
            .col-md-6
              %section
                .body
                  .pull-right
                    = link_to t('show.discontent.new_group'), discontent_posts_new_group_path(@project, asp: params[:asp]) ,remote: true, id: 'add_record',  class: 'btn btn-danger'
                  %h4=t('show.discontent.groups')
                  %ul.news-list#panel_union_group
                    - @aspect.aspect_posts.by_status(2).created_order.each do |post|
                      %li{id: "post_union_#{post.id}"}
                        =render partial:'post', object: post

            .col-md-6
              %section
                .body
                  %h4=t('show.discontent.title')
                  %ul.news-list
                    =render partial:'post_short', collection: @aspect.aspect_posts.by_status([0,1]).sort_by{|c| c.discontent_post.nil? ? 0 : 1}


        #improve.tab-pane.fade
          .row
            .col-md-6
              .chat-messages
                = render partial: 'shared/improve_comment',collection: @comments_all
        #new_posts.tab-pane.fade

- else
  .col-md-6
    %section
      .body
        - if signed_in? and (@project.status == 3 or @project.demo?)
          .pull-right
            = link_to t('link.add_record'), new_discontent_post_path(@project, asp: params[:asp]) , id: 'add_record',  class: 'btn btn-danger'
        - if boss? and @project.status == 7
          .pull-right
            = link_to t('show.discontent.add_required'), new_discontent_post_path(@project, asp: params[:asp], required: true) , id: 'add_record',  class: 'btn btn-danger'
        %h4=t('show.discontent.title')

        %ul.news-list
          =render partial:'post_short', collection: @posts

  .col-md-6
    -if boss?
      %section
        %header
          %h3 Фильтры
        .body
          = form_tag(@project ? "/project/#{@project.id}/general_news" : general_news_path, {method: :get, id: 'filter_news'}) do
            %h4 Даты
            .form-group(style="margin-left:0;")
              %label{for: "date_begin"} С
              =text_field_tag "date_begin",params[:by_period] ? params[:by_period][:date_begin] : '', class: 'form-control datepicker', id:'date_begin'
            .form-group(style="margin-left:0;")
              %label{for: "date_end"} По
              =text_field_tag "date_end",params[:by_period] ? params[:by_period][:date_end] : '', class: 'form-control datepicker', id:'date_end'
            %input{:name => "date_all", :type => "checkbox", :checked => (params[:by_period] ? params[:by_period][:date_all] : nil) ? true : false} Все

            %br
            %h4 Лайки
            .form-group
              %input{:name => "type_like", :type => "radio", :value => "by_like", :checked => params[:type_content] == "by_comment" ? 'checked' : nil} Пролайканы
              %br
              %input{:name => "type_like", :type => "radio", :value => "by_unlike", :checked => params[:by_content] == "by_content" ? 'checked' : nil} Не пролайканы
              %br
              %input{:name => "type_like", :type => "radio", :value => "content_all", :checked => params[:content_all] == "content_all" ? 'checked' : nil} Все
            %h4 Замечания
            .form-group
              %input{:name => "type_note", :type => "radio", :value => "by_note", :checked => params[:type_content] == "by_comment" ? 'checked' : nil} Замечания
              %br
              %input{:name => "type_note", :type => "radio", :value => "content_all", :checked => params[:content_all] == "content_all" ? 'checked' : nil} Все
            %h4 Проверено
            .form-group
              %input{:name => "type_verify", :type => "radio", :value => "by_verified", :checked => params[:type_content] == "by_comment" ? 'checked' : nil} Проверено
              %br
              %input{:name => "type_verify", :type => "radio", :value => "by_unverified", :checked => params[:by_content] == "by_content" ? 'checked' : nil} Не проверено
              %br
              %input{:name => "type_verify", :type => "radio", :value => "content_all", :checked => params[:content_all] == "content_all" ? 'checked' : nil} Все
            %h4 Пользователи
            -if @users_for_news
              = select_tag 'select_users_for_news', options_from_collection_for_select(@users_for_news, "id", "to_s"),
              prompt: 'Выберите пользователя', class: "form-control"

            %br
            %br
            %actions
              %input.btn.btn-success{:type => "submit", :id  => "send_filter", :value => "Применить"}
      %br
    %section
      .body
        %h4=t('show.improve.problem')
        .chat-messages
          = render partial: 'shared/improve_comment',collection: @comments_all
