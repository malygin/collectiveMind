.stage-info-sort-block
  #tooltip2_1.btn-group.tooltip1{"data-placement" => "bottom", "data-toggle" => "tooltip", "data-trigger" => "manual", :title => "Жмите сюда, чтобы выбрать аспект из выпадающего списка. На экране отобразятся несовершенства, связанные только с этим аспектом."}
    %span Фильтр аспектов:
    %a.dropdown-toggle.select-aspect{"data-toggle" => "dropdown"} все
    %ul.dropdown-menu.index-of-aspects#filter
      %li{data: {aspect: "*"}}
        %input#ex2_2_0{:name => "ex2_2", :type => "radio", :value => "0"}/
        %label.checkox_item{:for => "ex2_2_0"}
          %span
            %span.vert_stripe.back1
            %span.vert_stripe.back2
            %span.vert_stripe.back3
          %span.text_label Все аспекты
          - new_posts = @project.discontents.after_last_visit_posts(last_time_visit_page('discontent')).size
          - if new_posts > 0
            %span.cb_doc
              = new_posts
          - new_comments = @project.discontents.after_last_visit_comments(last_time_visit_page('discontent')).size
          - if new_comments > 0
            %span.cb_com
              = new_comments
      %li{data: {aspect: "#"}}
        %input#ex2_2_1{:name => "ex2_2", :type => "radio", :value => "1"}/
        %label.checkox_item{:for => "ex2_2_1"}
          %span
            %span.vert_stripe.back0
            %span.vert_stripe.back0
            %span.vert_stripe.back0
          %span.text_label Без аспекта
          - new_posts = @project.discontents.after_last_visit_posts(last_time_visit_page('discontent')).size
          - if new_posts > 0
            %span.cb_doc
              = new_posts
          - new_comments = @project.discontents.after_last_visit_comments(last_time_visit_page('discontent')).size
          - if new_comments > 0
            %span.cb_com
              = new_comments
      - @aspects.each_with_index do |aspect, index|
        %li.checkbox_item{id: "button_aspect_#{aspect.id}", data: {project: @project.id, aspect: ".aspect_#{aspect.id}"}}
          %input{:id => "ex2_2_#{index+2}",:name => "ex2_2", :type => "radio", :value => "#{index+2}"}/
          %label.checkox_item{:for => "ex2_2_#{index+2}"}
            %span
              %span.color_counter.color_me{style: "background-color: #{aspect.color}"}
                %span
                  = aspect.aspect_posts.by_status_for_discontent(@project).count
            %span.text_label
              = aspect.content
            - new_posts = aspect.aspect_posts.after_last_visit_posts(last_time_visit_page('discontent')).size
            - if new_posts > 0
              %span.cb_doc
                = new_posts
            - new_comments = aspect.aspect_posts.after_last_visit_comments(last_time_visit_page('discontent')).size
            - if new_comments > 0
              %span.cb_com
                = new_comments

.stage-info-sort-block
  .row
    %br/
    .col-md-7
      %span.stage-heading
        Несовершенства
        ="(#{@posts.count})"
    .col-md-5
      .sort-block.pull-right
        %span.sort-label Сортировать по новым:
        %span#sorter
          %span.sort-1.sort_btn.sprite_com.sprite-item2_2_1.sort-comment{data: {name: 'sort', desc: 0, type: 'comment'}}
            - if new_comments > 0
              %span
                = new_comments
          %span#tooltip2_2.sort-2.sort_btn.sprite_doc.sprite-item2_1.tooltip1.sort-date.active{data: {name: 'sort', desc: 0, type: 'date'}, "data-placement" => "bottom", "data-toggle" => "tooltip", "data-trigger" => "manual", :title => "При помощи этих фильтров вы можете выбирать, в каком порядке будут отображаться несовершенства."}
            - if new_posts > 0
              %span
                = new_posts

        -#%span#filter_all.sort-all{data: {aspect: "*"}} ВСЕ
        = link_to new_discontent_post_path(@project, type_mechanic: 'simple'), id: 'add_record' do
          %button.btn.add-button
            %span
              = t('techniques.discontent_posts_simple')

.stage-post-block
  .row#tab_aspect_posts
    -#= render partial: 'post_short', collection: @posts

#render_discontent_post

- if shown_intro('discontent_intro') == ''
  = render partial: 'popup_welcome'
- if current_user.can_vote_for(:discontent, @project)
  = render partial: 'popup_vote'




-#%h4
-#  Выберите аспект
-#  %i.fa.fa-question-circle
-#.ui-4.second-stage
-#  .container
-#    .sort-block
-#      Сортировать:
-#      %span.sort-item.sort-date{data: {desc: -1, type: 'date'}}
-#        = image_tag 'sort-date.jpg'
-#      %span.sort-item.sort-rate{data: {desc: 0, type: 'rate'}}
-#        = image_tag 'sort-rate.jpg'
-#      %span.sort-item.sort-all{data: {desc: 0, type: 'all'}} ВСЕ
-#
-#    %div
-#      %ul.nav.nav-tabs.second-stage.ui-29.tabs-discontents
-#        - @project.aspects.main_aspects.each do |asp|
-#          %li{class: "#{'active' if asp == @aspect}"}
-#            %button{'data-toggle' => 'tab', href: "#tab_aspect_#{asp.id}", id: "link_aspect_#{asp.id}", 'data-project' => @project.id, 'data-aspect' => asp.id}
-#              .block-content
-#                .fill-container{style: "border-color: #{asp.color};"}
-#                  %span.fill-limit{'data-limit' => "#{asp.rate_aspect}", style: "color: #{asp.color};"}
-#                  .filler-outer
-#                    .filler{style: "background-color: #{asp.color};"}
-#
-#      .tab-content.second-stage
-#        .tab-pane.fade.in.active
-#          .col-md-4.discontent-block
-#            .imperfection-add-block.lined-block
-#              .add-imperf
-#                = link_to project_user_path(@project, current_user), id: 'add_record' do
-#                  .plus-circle +
-#                  %span Добавить несовершенство
-#              %table
-#                %tr
-#                  %td.imperf-left-column
-#                  %td.imperf-right-column
-#                %tr
-#                  %td.imperf-left-column.what-cell
-#                  %td.imperf-right-column
-#                %tr
-#                  %td.imperf-left-column
-#                  %td.imperf-right-column
-#                %tr
-#                  %td.imperf-left-column
-#                  %td.imperf-right-column
-#                %tr
-#                  %td.imperf-left-column
-#                  %td.imperf-right-column
-#                %tr
-#                  %td.imperf-left-column
-#                  %td.imperf-right-column
-#
-#          #tab_aspect_posts
-#            = render partial: 'post_short', collection: @posts
-#
-##render_discontent_post
-##render_discontent_comments
-##render_discontent_form
-#
-#- if current_user.can_vote_for(:discontent, @project)
-#  #popup-vote-discontents.popup-window.vote-popup.mfp-hide
-#    .popup
-#      .popup-header-dnd
-#        .popup-header.popup-top-rounded
-#          %h2.color.mass-red Голосование
-#        .drag-n-drop-zone
-#          .dnd-hand
-#      .popup-voting.popup-bottom-rounded
-#        %p
-#          Выберите несовершенства, которые вам понравились, и перетащите их в изображение руки или нажмите на кнопку "проголосовать"
-#        .popup-owl-navigation
-#          -# if > 3
-#          #owl-arrow-left-1.owl-arrow.pull-left
-#          #owl-arrow-right-1.owl-arrow.pull-right
-#        #owl-vote-1.owl-carousel.owl-vote
-#          -# - @posts.each_slice(6) do |posts|
-#          .row
-#            -# - @posts.each_slice(3) do |posts|
-#            .col-xs-6.owl-column
-#              -# posts.each do |post|
-#              -2.times do
-#                = render partial: 'post_for_vote'
-#            .col-xs-6.owl-column
-#              -2.times do
-#                = render partial: 'post_for_vote'
-#        %button#vote-button1.vote-button.btn.btn-mass-red{:disabled => "disabled"} Проголосовать
-#        -#  = link_to  next_post_for_vote_discontent_post_path(@project,post_for_vote, against: true), remote: true, method: :put, class: 'btn btn-success btn-sm vote-button', id: "vote_positive_#{post_for_vote.id}" do
-#        -#    %span.glyphicon.glyphicon-thumbs-up
-#        -#    =t('voting.discontent.important')
-#        -#  = link_to  next_post_for_vote_discontent_post_path(@project,post_for_vote, against: false), remote: true, method: :put, class: 'btn btn-danger btn-sm vote-button', id: "vote_negative_#{post_for_vote.id}" do
-#        -#    %span.glyphicon.glyphicon-thumbs-down
-#        -#    =t('voting.discontent.not_important')

