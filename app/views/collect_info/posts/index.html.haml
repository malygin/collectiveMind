-unless @questions_progress == 100
  .stage-info-sort-block
    .row
      %br/
      .col-md-7
        %span.stage-heading
          Аспекты
          = "(#{@proc_aspects.size})"
      .col-md-5
        .sort-block.pull-right
          = link_to new_aspect_post_path(@project, type_mechanic: 'simple'), id: 'new_aspect_posts' do
            %button.btn.add-button.disabled
              %span
                = t('techniques.aspect_posts_simple')
  / Aspects block (UI four) starts
  .ui-4.first-stage
    .container
      / UI content
      .block-content
        / Tabs
        / Nav tabs
        .slider-wrapper
          %a.slider-left.slider-nav
            %i.fa.fa-caret-left.font_lighter_grey
          %a.slider-right.slider-nav
            %i.fa.fa-caret-right.font_lighter_grey
          .slider-outer
            %ul.slider-inner.list-unstyled#first-stage-slider{ data: {project: @project.id} }
              %li.active
                .slider-item.active
                  .c1-item
                    %a{id: "aspect_0", "data-toggle" => "tab", :href => "#tab_aspect_0"}
                      %span.c1-item-inner{style: "border-top-color:#eac85e;"}
                        Введение в процедуру
              - @aspects.each_with_index do |aspect, index|
                %li.li_aspect{id: "li_aspect_#{aspect.id}", class: "#{'complete' if aspect.missed_questions(current_user).size == 0}"}
                  .slider-item
                    .c1-item
                      %a{id: "aspect_#{aspect.id}", "data-toggle" => "tab", :href => "#tab_aspect_#{aspect.id}"}
                        %span.c1-item-inner.color_me{style: "border-top-color: #{aspect.color};"}
                          =aspect.content

        / Tab panes
        .tab-content
          .tab-pane.main-pane.active.fade.in{id: "tab_aspect_0"}
            .row
              .col-md-12.col-sm-12
                .aspect-main-block(style="text-align:left;padding:20px;border-top-color:#eac85e;")
                  %h6.bold
                    1. Деятельность  которая требует совершенствования и её результаты.
                  %p
                    Организация системы продаж MD обсуждается в настоящее время только в процессе подготовки
                    тестовой процедуры.  Все необходимые этапы подготовки и самой коммерческой
                    деятельности отсутствуют, не проработаны и даже не обдуманы.
                  %h6.bold
                    2. Участники.
                  %p
                    В настоящее время подготовку к коммерческой деятельности ведет
                    группа разработчиков MD и два потенциальных  пользователя  - дистрибутора MD.
                    Роли участников:
                    %ul
                      %li Группа разработчиков MD – подготовка продукта, участие в тестовой процедуре
                      %li В.Видро -  подготовка  и проведение варианта процедуры для  российского рынка
                      %li Ю. Хоффман – подготовка  варианта процедуры для  израильского  рынка
                  %h6.bold
                    3. Другие заинтересованные стороны (выгодоприобретатели деятельности)  –
                  %p
                    собственники компании разработчика процедуры
                  %h6.bold
                    4. Используемые технологии, методы и ресурсы:
                  %p
                    Подготовлены две версии тестовой процедуры для российского и израильского
                    рынков.  Цель тестирования – оценка восприятия процедуры потенциальными
                    пользователями и последующая её корректировка при необходимости
                  %h6.bold
                    5. Условия, в которых осуществляется деятельность и место, которое занимает
                    рассматриваемая деятельность (бизнес процесс) в общей картине компании
                  %p
                    В компании нет ответственных за организацию продаж. Деятельность по продажам
                    необходимо  организовывать с нуля. Необходимые ресурсы не определены. Персонал
                    озабочен (в хорошем смысле слова).


          - @aspects.each_with_index do |asp, index|
            .tab-pane.main-pane.fade{id: "tab_aspect_#{asp.id}"}
              .container
                - if asp.knowbase_posts.size > 1
                  .row
                    .col-md-8.col-sm-8.min-col-right-padd
                      %ul.nav.nav-tabs.aspects_tabs{:role => "tablist"}
                        - asp.knowbase_posts.each_with_index do |post, i|
                          %li{class: "#{'active' if i == 0}", role: "presentation"}
                            %a{style: "background-color:#{asp.color};" ,"aria-controls" => "Статья #{i+1}", "data-toggle" => "tab", :href => "#article_#{index+1}_#{i+1}", :role => "tab"}
                              = trim_content(post.title, 30)
                .row
                  .col-md-8.col-sm-8.min-col-right-padd
                    .aspect-main-block.color_me{style: "border-top-color: #{asp.color};"}
                      - if asp.knowbase_posts.size > 1
                        .tab-content
                          - asp.knowbase_posts.each_with_index do |post, i|
                            .tab-pane.fade{id: "article_#{index+1}_#{i+1}", class: "#{'active in' if i == 0}", role: "tabpanel"}
                              %h6.aspect-main-block-heading
                                = post.title
                              %p.aspect-main-block-text
                                = post.content.html_safe unless post.content.nil?
                      - else
                        - asp.knowbase_posts.each_with_index do |post, i|
                          %h6.aspect-main-block-heading
                            = post.title
                          %p.aspect-main-block-text
                            = post.content.html_safe unless post.content.nil?

                  .col-md-4.col-sm-4.min-col-left-padd
                    .carousel.slide.questionsCarousel{id: "questionsCarousel_#{asp.id}", "data-ride" => "carousel"}
                      .aspect-questions-block.color_me{:style => "border-top-color: #{asp.color};"}
                        -if asp.missed_questions(current_user).size > 0
                          %h4.block-with-left-icon.pull-left
                            %i.left-icon.fa.fa-2x.fa-comments
                            Вопросы по аспекту
                          %span.pull-right.question_count
                            %span{id: "question_count_#{asp.id}"}
                              = asp.questions.size - asp.missed_questions(current_user).size + 1
                            из
                            = asp.questions.size
                          .carousel-inner
                            - asp.missed_questions(current_user).each_with_index do |question, ind|
                              .item{id: "question_#{question.id}", class: "#{'active' if ind == 0}"}
                                %p.text.block-with-left-icon
                                  %span.left-icon.pull-right="#{ind + 1}."
                                  = question.content
                                -#.hint.close-notice{id:"hint_question_#{question.id}", style: "color:#{asp.color};border-color:#{asp.color};"}
                                -#  = question.hint
                                -#  %span.close-button
                                -#    %i.fa.fa-times-circle-o
                                -#.hint.close-notice{id:"wrong_question_#{question.id}", style: "color:#{asp.color};border-color:#{asp.color};"}
                                -#  Ответ неправильный, воспользуейтесь подсказкой
                                -#  %span.close-button
                                -#    %i.fa.fa-times-circle-o

                                = form_tag(answer_question_collect_info_post_path(@project, id: asp.id, question_id: question.id), {method: :put, remote: true, class: 'form instruments-block', id: 'form_answer_question', multipart: true}) do
                                  .btn-group#answers_buttons(data-toggle="buttons")
                                    - question.answers.each do |answer|
                                      .form-group
                                        %button.btn.btn-xs.btn-white.answer-question(id="answer_#{answer.id}")
                                          = check_box_tag 'answers[]', answer.id
                                          = answer.content
                                        %i.fa.fa-check{style: "color:#{asp.color};"}
                                  .clearfix
                                    = text_area_tag 'content', nil, rows: 1, placeholder: 'Ваше пояснение'
                                  .form-group.bottom-buttons
                                    -#%a.btn.btn-outline.notice-button.color_me{style: "border-color: #{asp.color};", data: {question: question.id}} Подсказка
                                    %button#send_answers.btn.answer-button.questionsCarousel-target.color_me{type: "submit", style: "background-color: #{asp.color};"} Ответить
                        -else
                          %h4.block-with-left-icon.pull-left
                            %i.left-icon.fa.fa-2x.fa-comments
                            Вы ответили на все вопросы по данному аспекту.
                          %span.pull-right.question_count
                          .carousel-inner

-else
  = render partial: 'discuss_aspects'


#render_core_aspect


= render partial: 'popup_welcome'
= render partial: 'popup_greetings'
- if current_user.can_vote_for(:collect_info, @project)
  = render partial: 'popup_vote'
