.chat-message{id: "comment_#{improve_comment.id}"}
  = render 'users/user_post', user: improve_comment.user

  .chat-message-body.stage_menu1{id: "comment_content_#{improve_comment.id}", class: "#{comment_stat_color(improve_comment)}"}
    %span.arrow
    .sender
      =link_to improve_comment.user, user_path(@project, improve_comment.user)
      = render partial: '/shared/user_online', object: improve_comment.user
      = role_label(improve_comment.user) if improve_comment.user
      %span.pull-right
        =label_for_comment_status(improve_comment,'discontent',t('show.problem'))
        =label_for_comment_status(improve_comment,'concept',t('show.idea'))
        -#=render partial: '/shared/label_for_comment_status', locals: {comment: improve_comment, status: 'discontent', title: 'Проблема'}
        -#=render partial: '/shared/label_for_comment_status', locals: {comment: improve_comment, status: 'concept', title: 'Идея'}

        - if boss? or role_expert? or stat_expert?
          =link_to({:controller => improve_comment.post.class.name.underscore.pluralize, :action => :comment_status, :id => improve_comment.post.id, :comment_id => improve_comment.id, :discuss_status => 1, :comment_stage => get_stage_for_improve(improve_comment.get_class)},  :remote => true, :method => :put, class: "link_status",  id: "discuss_stat_comment_#{improve_comment.id}") do
            %span.label_discuss.label(class="#{label_discuss_stat(improve_comment)}")=t('show.discuss')
          =link_to({:controller => improve_comment.controller_name_for_action, :action => :comment_status, :id => improve_comment.post.id, :comment_id => improve_comment.id, :approve_status => 1, :comment_stage => get_stage_for_improve(improve_comment.get_class)},  :remote => true, :method => :put, class: "link_status",  id: "approve_stat_comment_#{improve_comment.id}") do
            %span.label_approve.label(class="#{label_approve_stat(improve_comment)}")=t('show.important')
        - else
          -if improve_comment.discuss_status
            %span.label-danger=t('show.discuss')
          -if improve_comment.approve_status
            %span.label-success=t('show.important')

    .text
      %div{id: "comment_text_#{improve_comment.id}"}
        =simple_format(improve_comment.content)
      - if current_user?(improve_comment.user) or boss?
        %div.redactor{id: "redactor_comment_#{improve_comment.id}"}
          =link_to t('link.edit'), {:action => :edit_comment, :id => improve_comment.id},:remote => true, class: 'btn btn-info btn-xs',id: "edit_comment_#{improve_comment.id}"
          \|
          = link_to t('link.remove'), {:action => :destroy_comment, :id => improve_comment.id}, :method => :put, :remote => true, :confirm => t('confirm.delete_comment'), class: 'btn btn-danger btn-xs',id: "destroy_comment_#{improve_comment.id}"

      .pull-right
        =link_for_improve(improve_comment).html_safe if link_for_improve(improve_comment)
        =link_to "#{@project.status < 7 ? t('show.improve.name_discontent') : t('show.improve.name_concept')}", {:action => :new, :asp => params[:asp] ? params[:asp] : @project.proc_aspects.order(:id).first, :improve_comment => improve_comment.id, :improve_stage => get_stage_for_improve(improve_comment.get_class) }, :method => :get,  id: "improve_comment_#{improve_comment.id}", class: 'btn btn-success btn-xs'
        |
        =link_to({controller: improve_comment.class.name.underscore.pluralize.gsub('/comments', '/posts'), :action => :like_comment, :project => @project, :id => improve_comment.id, :against => false}, :remote => true, :method => :put, class: "popup-likes", id: "like_comment_#{improve_comment.id}") do
          %span
            %span(id="plus_counter_#{improve_comment.id}" style="margin-right:0;")
              =improve_comment.users_pro.count
            %i.fa.fa-thumbs-o-up
        |
        =link_to({controller: improve_comment.class.name.underscore.pluralize.gsub('/comments', '/posts'), :action => :like_comment, :project => @project,  :id => improve_comment.id, :against => true}, :remote => true, :method => :put, class: "popup-dislikes", id: "dislike_comment_#{improve_comment.id}") do
          %span
            %span(id="minus_counter_#{improve_comment.id}" style="margin-right:0;")
              =improve_comment.users_against.count
            %i.fa.fa-thumbs-o-down
        - if boss?
          |
          =link_to({action: :plus_comment, id: improve_comment.id},  remote: true, method: :put,  id: "plus_comment_#{improve_comment.id}") do
            -if improve_comment.useful
              %span.text-danger=t('show.revert_score')
            -else
              %span.text-success=t('show.add_score')

      .time.pull-left
        =time_ago_in_words(improve_comment.created_at)
      %br
      -if improve_comment.improve_disposts.present? and @project.status < 7
        %br
        %section
          .body
            %ul
              - improve_comment.improve_disposts.each do |post|
                %li(style="line-height:30px;")
                  =t('show.improve.discontent')
                  =link_to post.user, user_path(@project, post.user)
                  =link_to t('link.more'), discontent_post_path(@project, post), :class=> 'btn btn-primary btn-xs'
      -if improve_comment.improve_concepts.present?
        %br
        %section
          .body
            %ul
              - improve_comment.improve_concepts.each do |post|
                %li(style="line-height:30px;")
                  =t('show.improve.concept')
                  =link_to post.user, user_path(@project, post.user)
                  =link_to t('link.more'), concept_post_path(@project, post), :class=> 'btn btn-primary btn-xs'



